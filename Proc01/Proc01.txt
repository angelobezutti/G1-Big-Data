CREATE OR REPLACE PROCEDURE cria_sessoes(
	cod_espetaculo_parametro IN INT, 
	inicio IN TIMESTAMP WITHOUT TIME ZONE,
	cod_periodicidade_parametro IN INT, 
	duracao IN INT, 
	preco IN NUMERIC) AS $$
DECLARE
	espetaculo espetaculo;
    	periodicidade periodicidade;
BEGIN
    	SELECT * FROM espetaculo WHERE cod_espetaculo = cod_espetaculo_parametro INTO espetaculo;
	IF NOT FOUND THEN
		RAISE EXCEPTION 'Espetaculo não existe, por favor insira um válido!';
	END IF;
	
	SELECT * FROM periodicidade WHERE cod_periodicidade = cod_periodicidade_parametro INTO periodicidade;
	IF NOT FOUND THEN
		RAISE EXCEPTION 'Periodicidade não existe, por favor insira uma válida!';
	END IF;
	
	INSERT INTO sessao (cod_espetaculo, data_hora_inicio, duracao, preco, cod_periodicidade)
	VALUES (cod_espetaculo_parametro, inicio, duracao, preco, cod_periodicidade_parametro);
END;
$$
LANGUAGE plpgsql;

--SELECT * FROM sessao
--set search_path to trabalho_g1
--CALL cria_sessoes(3, '2023-11-23', 1, 40, 10.00);
